<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/context 
       http://www.springframework.org/schema/context/spring-context-2.5.xsd
       http://camel.apache.org/schema/spring 
       http://camel.apache.org/schema/spring/camel-spring.xsd">



<!-- This assembly defines an upper and a lower limit for a parameter, with a count filter. The limits 
     are fully configurable, i.e. can be dynamically enabled / disabled and changed. -->



	<context:annotation-config />


	<bean id="lowerLimit" class="org.hbird.business.validation.parameter.LowerLimit">
		<constructor-arg index="0" value="LowerLimitErrorState"/>
		<constructor-arg index="1" value="Lower limit for parameter."/>
		<constructor-arg index="2" value="-3"/>
	</bean> 

	<bean id="upperLimit" class="org.hbird.business.validation.parameter.UpperLimit">
		<constructor-arg index="0" value="UpperLimitErrorState"/>
		<constructor-arg index="1" value="Upper limit for parameter."/>
		<constructor-arg index="2" value="3"/>
	</bean> 

	<bean id="lowerLimitChangeFilter" class="org.hbird.business.validation.base.OnlyChangeFilter"/>
	
	<bean id="upperLimitChangeFilter" class="org.hbird.business.validation.base.OnlyChangeFilter"/>
	
	<bean id="lowerLimitCountFilter" class="org.hbird.business.validation.base.ViolationCountFilter">
        <constructor-arg index="0" value="2"/>
	</bean>
	
	<bean id="upperLimitCountFilter" class="org.hbird.business.validation.base.ViolationCountFilter">
	    <constructor-arg index="0" value="2"/>
	</bean>
	
	
	<camelContext id="context" xmlns="http://camel.apache.org/schema/spring">
		<template id="producer"/>

		<route>
			<from uri="direct:switchAll"/>
			<multicast parallelProcessing="true">
				<to uri="direct:enabledUpperLimit"/>
				<to uri="direct:enabledLowerLimit"/>
			</multicast>
		</route>


		<!-- Route to enable / disable the upper limit of Parameter 1.  -->
		<route>
			<from uri="direct:enabledUpperLimit"/>
			<to uri="bean:upperLimit?method=processEnabled"/>
			<to uri="direct:UpperLimitFilters"/>
		</route>

		<!-- Route to enable / disable the lower limit of Parameter 1.  -->
		<route>
			<from uri="direct:enabledLowerLimit"/>
			<to uri="bean:lowerLimit?method=processEnabled"/>
			<to uri="direct:LowerLimitFilters"/>
		</route>


		<!-- Route to change the upper limit of Parameter 1.  -->
		<route>
			<from uri="direct:UpperLimitParameter"/>
			<to uri="bean:upperLimit?method=processLimit"/>
			<to uri="direct:UpperLimitFilters"/>
		</route>

		<!-- Route to change the lower limit of Parameter 1.  -->
		<route>
			<from uri="direct:LowerLimitParameter"/>
			<to uri="bean:lowerLimit?method=processLimit"/>
			<to uri="direct:LowerLimitFilters"/>
		</route>


		<route>
			<from uri="direct:parameter"/>
			<multicast parallelProcessing="true">
				<to uri="direct:StartParameterUpperLimit"/>
				<to uri="direct:StartParameterLowerLimit"/>
			</multicast>
		</route>

		<!-- Route to calculate the upper limit of parameter 1 -->
		<route>
			<from uri="direct:StartParameterUpperLimit"/>
			<to uri="bean:upperLimit?method=processParameter"/>
			<to uri="direct:UpperLimitFilters"/>
		</route>

		<!-- Route to calculate the lower limit of parameter 1 -->
		<route>
			<from uri="direct:StartParameterLowerLimit"/>
			<to uri="bean:lowerLimit?method=processParameter"/>
			<to uri="direct:LowerLimitFilters"/>
		</route>


		<!-- Filters -->
		<route>
			<from uri="direct:UpperLimitFilters"/>
			<to uri="bean:upperLimitCountFilter"/>
			<to uri="bean:upperLimitChangeFilter"/>
			<to uri="mock:result"/>			
		</route>
		
		<route>
			<from uri="direct:LowerLimitFilters"/>
			<to uri="bean:lowerLimitCountFilter"/>
			<to uri="bean:lowerLimitChangeFilter"/>
			<to uri="mock:result"/>			
		</route>
				
	</camelContext>
</beans>
