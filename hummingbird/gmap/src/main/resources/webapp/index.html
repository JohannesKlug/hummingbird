<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
html {
	height: 100%
}

body {
	height: 100%;
	margin: 0px;
	padding: 0px
}

#map_canvas {
	height: 100%
}
</style>

<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=true">
</script>

<script type="text/javascript" 
	src="dojo/dojo/dojo.js.uncompressed.js">
</script>

<script type="text/javascript"
	src="dojo/dojox/cometd.js.uncompressed.js">
</script>

<script type="text/javascript">

	dojo.require("dojox.cometd");

	function setupComet(){
	  dojox.cometd.init('/cometd');
	  dojox.cometd.subscribe("/gui-cometd-gmap-0.0.1-SNAPSHOT/position", callback);
	}
	
	dojo.addOnLoad(setupComet);

	var poly;
	var map;
	var infowindow;
	var marker;
	
  function setupMap() {
    var latlng = new google.maps.LatLng(0, 0);

    var myOptions = {
      zoom: 3,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.HYBRID
    };
    
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    marker = new google.maps.Marker({
        position: latlng,
        map: map,
        title:"Humsat2"
    });

    var polyOptions = {
    	    strokeColor: '#FF00FF',
    	    strokeOpacity: 1.0,
    	    strokeWeight: 3
    	  }
	  
  	poly = new google.maps.Polyline(polyOptions);
   	poly.setMap(map);

    var contentString = '<div id="content">'+
    '<div id="siteNotice">'+
    '</div>'+
    '<h1 id="firstHeading" class="firstHeading">Humsat</h1>'+
    '<div id="bodyContent">'
    +'<p><b>' + new Date() + '</b></p>' +
    '<b>... still waiting for position data.</b>' +
    '<p>The simulated Hummingbird satellite (Humsat).</p></div></div>';
    
      infowindow = new google.maps.InfoWindow({
    	    content: contentString
    	});

      google.maps.event.addListener(marker, 'click', function() {
    	  infowindow.open(map,marker);
    	});		
     
  }

  function callback(coord){
	  if (coord) {
	      var contentString = '<div id="content">'+
	      '<div id="siteNotice">'+
	      '</div>'+
	      '<h1 id="firstHeading" class="firstHeading">Humsat</h1>'+
	      '<div id="bodyContent">'
	      +'<p><b>' + new Date() + '</b></p>' +
	      '<b>Longitude:</b>' + coord.data.lng + '</p>' + 
	      '<b>Latitude:</b>' + coord.data.lat + '</p>' +
	      '<b>Elevation:</b>' + coord.data.ele + ' meter' + '</p>' +
	      '<p>The simulated Hummingbird satellite (Humsat).</p>';

	      if (coord.data.state) {
		      contentString = contentString + '<p>Status: <b>ERROR</b></p>';
	      }
	      else {	      
	    	    contentString = contentString + '<p>Status: Nominal</p>';
	      }
	      contentString = contentString + '</div></div>';
	      			  		  
		  infowindow.setContent(contentString);
	      var latlng = new google.maps.LatLng(coord.data.lat, coord.data.lng);
	      var path = poly.getPath();
	      path.push(latlng);
	      marker.setPosition(latlng);
	      map.fitBounds(bounds);
      }         
}         

  

</script>
</head>
<body onload="setupMap()" onunload="GUnload()">
<div id="map_canvas" style="width: 100%; height: 100%"></div>
</body>
</html>