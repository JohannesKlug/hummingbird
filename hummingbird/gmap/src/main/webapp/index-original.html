<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<head>
<title>Hummingbird - Map View</title>
<script type="text/javascript" src="dojo/dojo/dojo.js.uncompressed.js"></script>
<script type="text/javascript"
	src="dojo/dojox/cometd.js.uncompressed.js"></script>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA_9P3leoajNRw866Ba34-tBTwM0brOpm-All5BF6PoaKBxRWWERQBp4nDkS9za5_7YtEoet0y1AdBIw" type="text/javascript"></script>
</head>
<script type="text/javascript">
    
        dojo.require("dojox.cometd");
    
        function setupComet(){
          dojox.cometd.init('/cometd');
          dojox.cometd.subscribe("/service/test", callback);
        }

        dojo.addOnLoad(setupComet);
        
        function setupMap() {
           if (GBrowserIsCompatible()) {
	          map = new GMap2(document.getElementById("map"));
	          map.addControl(new GSmallMapControl());
	          map.addControl(new GMapTypeControl());

    	      var origin = new GLatLng(51.517476, -0.086603);
	          map.setCenter(origin, 15);

  	          marker = new GMarker(origin);
	          map.addOverlay(marker);
           }
         }
        
         function callback(coord){
              var latitude = coord.data.lat;
              var longitude = coord.data.lng;      
        	  if (coord) {
        		    var latLng = new GLatLng(coord.data.lat, coord.data.lng);
        		    map.addOverlay(new GPolyline([marker.getPoint(),latLng]));
        		    marker.setPoint(latLng);
        		    map.setCenter(latLng);
              }         
        }         
        
    </script>

</head>
<body onload="setupMap()" onunload="GUnload()">
    <div id="map" style="width: 500px; height: 300px"></div>
</body>
</html>
